syntax = "proto3";

option csharp_namespace = "VoucherGrpc";

package voucher;

service Voucher {
  rpc CreateVoucher (CreateVoucherRequest) returns (VoucherResponse);
  rpc RedeemVoucher (RedeemVoucherRequest) returns (VoucherResponse);
  rpc GetVoucherStatus (VoucherStatusRequest) returns (VoucherResponse);
  rpc GetAllVouchers (UserRequest) returns (VoucherListResponse);
  rpc MigrateDatabase (Empty) returns (MigrationResponse);
}

// --- Requests ---

message CreateVoucherRequest {
  string userId = 1;
  string templateId = 2;     // Optional: template to base voucher on
}

message RedeemVoucherRequest {
  string code = 1;
  string userId = 2;
}

message VoucherStatusRequest {
  string code = 1;
}

message UserRequest {
  string userId = 1;
}

// --- Responses ---

message VoucherResponse {
  string code = 1;
  double amount = 2;
  bool isRedeemed = 3;
  string expiryDate = 4;     // ISO-8601 string
  string userId = 5;
  string templateId = 6;
  string message = 7;
}

message VoucherListResponse {
  repeated VoucherResponse vouchers = 1;
}

message MigrationResponse {
  bool success = 1;
  string message = 2;
}

message Empty {}
